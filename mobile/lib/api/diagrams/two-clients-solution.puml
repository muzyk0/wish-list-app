@startuml Two Clients Solution (Correct Approach)
!theme plain
!pragma layout smetana
skinparam backgroundColor #FFFFFF
skinparam packageStyle rectangle
skinparam shadowing false

rectangle "Wrong Approach âŒ" #FFE6E6 {
  rectangle "baseClient\nWITH middleware" as wrong #FF6B6B {
    rectangle "authMiddleware"
    rectangle "refreshMiddleware"
  }

  rectangle "auth.ts" as wrongAuth
  rectangle "api.ts" as wrongApi

  wrongAuth -down-> wrong : uses same\nclient
  wrongApi -down-> wrong : uses same\nclient

  note bottom of wrong
    ðŸ’¥ PROBLEM:
    â€¢ Middleware applied to ALL requests
    â€¢ Infinite recursion on refresh
    â€¢ Cannot separate concerns
  end note
}

rectangle "Correct Approach âœ…" #E8F5E9 {
  rectangle "baseClient\nNO middleware" as correct #90EE90 {
    rectangle "Clean HTTP client"
  }

  rectangle "ApiClient.client\nWITH middleware" as correctApi #90EE90 {
    rectangle "authMiddleware" as authMid
    rectangle "refreshMiddleware" as refMid
  }

  rectangle "auth.ts" as correctAuth
  rectangle "api.ts" as correctApiTs

  correctAuth -down-> correct : uses\nbaseClient
  correctApiTs -down-> correctApi : creates\nNEW client

  note bottom of correct
    âœ… SOLUTION:
    â€¢ Clean baseClient for auth
    â€¢ Separate client with middleware
    â€¢ No recursion possible
    â€¢ Clear separation of concerns
  end note
}

@enduml
