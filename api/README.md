# API Documentation

This directory contains OpenAPI 3.0 documentation for the Wish List API.

## Quick Start

### Generate Complete Documentation (One Command)

```bash
make docs
```

This single command will:
1. ‚úÖ Generate Swagger 2.0 from Go annotations (stored in `backend/docs/`)
2. ‚úÖ Convert to OpenAPI 3.0 (stored in `api/`)
3. ‚úÖ Split into organized files for better readability and AI agent consumption

## Files Structure

### Generated by Swag (OpenAPI 2.0) - Located in `backend/docs/`
- `backend/docs/docs.go` - Generated Go code for swagger documentation
- `backend/docs/swagger.json` - OpenAPI 2.0 specification in JSON format
- `backend/docs/swagger.yaml` - OpenAPI 2.0 specification in YAML format

### Converted (OpenAPI 3.0) - Located in `api/`
- `api/openapi3.json` - OpenAPI 3.0 specification in JSON format
- `api/openapi3.yaml` - OpenAPI 3.0 specification in YAML format

### Split Files (AI-Friendly Structure) - Located in `api/split/`
- `api/split/` - Directory containing organized split OpenAPI files (generated by Redocly)
  ```
  split/
  ‚îú‚îÄ‚îÄ openapi.yaml                          # Main entry point with references
  ‚îú‚îÄ‚îÄ paths/                                # API endpoints
  ‚îÇ   ‚îú‚îÄ‚îÄ auth_login.yaml
  ‚îÇ   ‚îú‚îÄ‚îÄ auth_register.yaml
  ‚îÇ   ‚îî‚îÄ‚îÄ protected_profile.yaml
  ‚îî‚îÄ‚îÄ components/
      ‚îî‚îÄ‚îÄ schemas/                          # Data models
          ‚îú‚îÄ‚îÄ LoginRequest.yaml
          ‚îú‚îÄ‚îÄ RegisterRequest.yaml
          ‚îî‚îÄ‚îÄ AuthResponse.yaml
  ```

**Benefits of Split Files:**
- üìñ **Better Readability**: Each endpoint and schema in separate file
- ü§ñ **AI Agent Friendly**: Easier for AI to process and understand
- üîç **Easy Navigation**: Find specific endpoints quickly
- üìù **Version Control**: Better git diffs and conflict resolution
- üîÑ **Maintainability**: Easier to update individual endpoints

## Viewing the Documentation

### Swagger UI

When the backend server is running, you can view the interactive API documentation at:

```
http://localhost:8080/swagger/index.html
```

### Redocly Preview

Preview OpenAPI 3.0 documentation in browser:

```bash
make swagger-preview
```

### OpenAPI Spec Files

You can also import the generated `openapi3.json` or `openapi3.yaml` files into tools like:
- [Swagger Editor](https://editor.swagger.io/)
- [Postman](https://www.postman.com/)
- [Insomnia](https://insomnia.rest/)

## Regenerating Documentation

After making changes to API handlers or adding new endpoints, regenerate the documentation:

```bash
# Generate OpenAPI 2.0 from Go annotations and convert to 3.0
make docs

# Just convert existing Swagger 2.0 to OpenAPI 3.0
make swagger-convert-v3

# Split OpenAPI 3.0 into organized files
make swagger-split

# Preview OpenAPI 3.0 in browser
make swagger-preview
```

### Manual Commands

```bash
# Generate Swagger 2.0 directly (output to backend/docs/)
swag init -g cmd/server/main.go -d backend -o backend/docs --parseDependency --parseInternal

# Convert to OpenAPI 3.0 (output to api/)
pnpm exec swagger2openapi backend/docs/swagger.json -o api/openapi3.json
pnpm exec swagger2openapi backend/docs/swagger.yaml -o api/openapi3.yaml

# Split with Redocly (output to api/split/)
pnpm exec redocly split api/openapi3.yaml --outDir=api/split
```

## Adding Documentation to Handlers

Use Go doc comments with Swagger annotations before handler functions:

### Example: Authentication Endpoint

```go
// Register godoc
// @Summary Register a new user
// @Description Create a new user account with email and password
// @Tags Authentication
// @Accept json
// @Produce json
// @Param user body RegisterRequest true "User registration information"
// @Success 201 {object} AuthResponse "User created successfully"
// @Failure 400 {object} map[string]string "Invalid request"
// @Router /auth/register [post]
func (h *UserHandler) Register(c echo.Context) error {
    // handler implementation
}
```

### Example: Protected Endpoint

```go
// GetProfile godoc
// @Summary Get user profile
// @Description Get the authenticated user's profile information
// @Tags User
// @Accept json
// @Produce json
// @Security BearerAuth
// @Success 200 {object} UserOutput "User profile"
// @Failure 401 {object} map[string]string "Unauthorized"
// @Router /protected/profile [get]
func (h *UserHandler) GetProfile(c echo.Context) error {
    // handler implementation
}
```

## Annotation Reference

- `@Summary` - Short description of the endpoint
- `@Description` - Detailed description
- `@Tags` - Group endpoints by tag (e.g., "Authentication", "User", "Wishlist")
- `@Accept` - Request content type (e.g., "json")
- `@Produce` - Response content type (e.g., "json")
- `@Param` - Request parameters (path, query, body)
- `@Success` - Success response (status code + schema)
- `@Failure` - Error response (status code + schema)
- `@Security` - Security scheme (e.g., "BearerAuth")
- `@Router` - API route path and HTTP method

## Documentation Resources

- [Swaggo Documentation](https://github.com/swaggo/swag)
- [OpenAPI Specification](https://swagger.io/specification/)
- [Echo Swagger Integration](https://github.com/swaggo/echo-swagger)

## For AI Agents

The split files in `split/` directory are optimized for AI agent consumption:

```bash
# Read individual endpoint
cat api/split/paths/auth_login.yaml

# List all endpoints
ls api/split/paths/

# List all schemas
ls api/split/components/schemas/
```

Each file is self-contained with clear references, making it easy for AI agents to:
- Understand individual endpoints
- Parse request/response schemas
- Generate client code
- Validate API contracts
